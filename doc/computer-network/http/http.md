# HTTP 协议

## 定义

HTTP（HyperText Transfer Protocol）即超文本传输协议，是一种详细规定了浏览器和万维网服务器之间互相通信的规则，它是万维网交换信息的基础，它允许将 HTML（超文本标记语言）文档从 Web 服务器传送到 Web 浏览器。

HTTP 协议目前最新版的版本是 2.0，HTTP 是一种无状态的协议，无状态是指 Web 浏览器与 Web 服务器之间不需要建立持久的连接，这意味着当一个客户端向服务器端发出请求，然后 Web 服务器返回响应（Response），连接就被关闭了，在服务器端不保留连接的有关信息。也就是说，HTTP 请求只能由客户端发起，而服务器不能主动向客户端发送数据（2.0 以前）。

## 工作原理

HTTP 协议工作于客户端-服务端架构上。浏览器作为 HTTP 客户端通过 URL 向 HTTP 服务端即 WEB 服务器发送所有请求。

Web 服务器有：Apache 服务器，IIS 服务器（Internet Information Services）等。

Web 服务器根据接收到的请求后，向客户端发送响应信息，HTTP 的默认端口号 `80`。

## 相关概念

无连接：无连接的含义是限制每次连接只处理一个请求。服务器处理完客户的请求，并收到客户的应答后，即断开连接。采用这种方式可以节省传输时间。

媒体独立：这意味着，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过 HTTP 发送。客户端以及服务器指定使用适合的 MIME-type 内容类型。

无状态：HTTP协议是无状态协议。无状态是指协议对于事务处理没有记忆能力。缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次连接传送的数据量增大。另一方面，在服务器不需要先前信息时它的应答就较快。

## 请求报文

```html
POST /test.php HTTP/1.1               //请求行
HOST：www.test.com                    //请求头
User-Agent：Mozilla/5.0 （windows NT 6.1；rv：15.0）Gecko/20100101 Firefox/15.0        //空白行，代表请求头结束
Username=admin&password=admin       //请求正文
```

HTTP 请求包括三部分，分别是请求行（请求方法）、请求头（消息报头）和请求正文。

HTTP 请求第一行为请求行，由三部分组成，第一部分说明了该请求时 POST 请求，第二部分是一个斜杠（/test.php），用来说明请求是该域名根目录下的 test.php，第三部分说明使用的是 HTTP1.1版本。

HTTP 请求第二行至空白行为请求头（也被称为消息头）。其中，HOST代表请求主机地址，User-Agent代表浏览器的标识，请求头由客户端自行设定。

请求正文就是客户端向服务器发送的数据。


## 请求方法

| 序号 | 方法    | 描述                                                         |
| :--- | :------ | :----------------------------------------------------------- |
| 1    | GET     | 请求指定的页面信息，并返回实体主体。                         |
| 2    | HEAD    | 类似于 GET 请求，只不过返回的响应中没有具体的内容，用于获取报头 |
| 3    | POST    | 向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST 请求可能会导致新的资源的建立和/或已有资源的修改。 |
| 4    | PUT     | 从客户端向服务器传送的数据取代指定的文档的内容。             |
| 5    | DELETE  | 请求服务器删除指定的页面。                                   |
| 6    | CONNECT | HTTP/1.1 协议中预留给能够将连接改为管道方式的代理服务器。    |
| 7    | OPTIONS | 允许客户端查看服务器的性能。                                 |
| 8    | TRACE   | 回显服务器收到的请求，主要用于测试或诊断。                   |
| 9    | PATCH   | 是对 PUT 方法的补充，用来对已知资源进行局部更新 。           |

## Http常用首部

- 通用
  - **cache-control** ： 控制缓存行为
  - **connection** ： 连接的性质，比如keep-alive
  - **user-Agent** ：用户信息
  - **Date** ：报文创建时间
- 请求
  - **Referrer Policy** : 表示来源的（浏览器所访问的前一个页面）,可以用于辅助检测crsf攻击，一般浏览器的默认值是**no-referrer-when-downgrade**，意思是https降级http的时候不传原地址。
  - **Accept** : 能正确接收的媒体类型
  - **Accept-XX**(Accept-Charset/Accept-Encoding/Accept-Language):能正确接收的xx
  - **Expect** :期待服务端的指定行文
  - **If-Match** :两端资源标记比较
  - **If-Modified-Since** : 比较时间 未修改返回304 Not Modified
  - **If-None-Match** :比较标记 未修改返回304 Not Modified
- 响应
  - **Location** : 重定向到某个location
  - **Server** : 服务器名字
  - **Age** :响应存在时间
  - **Accept-Ranges** ：可以接受的范围类型


## 响应状态码

#### 1xx：通知

- 100 客户端重新发起请求
- 101 更换协议

#### 2xx：成功

- 200 请求成功
- 201create 按照客户端请求创建一个新的资源
- 202Accept 请求无法或不被及时处理
- 204No Content 请求成功，但是报文不含实体的主体部分
- 205Reset Content 客户端充值内容
- 206Partial Content 进行范围请求

#### 3xx：重定向

- 301 Move Permanently 永久重定向，资源被分配到新的URL
- 302 Found 临时重定向
- 303 See Other，表示资源存在另一个URL
- 304 Not Modified 允许访问资源，和缓存有关
- 307 Temporary Redirect 临时重定向

#### 4xx：客户端错误

- 400 请求报文的语法错误
- 401 没有权限
- 403 Forbidden 资源存在但被拒绝访问
- 404 找不到请求的资源
- 405 Method Not Allowed 不支持的请求方法，比如只支持 Get

#### 5xx：服务器错误

- 500 服务器内部错误，异常
- 501 不支持请求的方法
- 502 Bad Gateway 代理服务器发生问题
- 503 Server Unavailable 服务器暂时处于超负荷状态